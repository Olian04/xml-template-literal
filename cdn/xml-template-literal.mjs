class e extends Error{constructor(e){super("UnexpectedEOF"+(e?` near: ${e}`:""))}}class t extends Error{constructor(e,t){super(`UnexpectedToken: Expected "${e}" but got "${t}"`)}}const n=(e,n,r)=>{if(r[e]!==n)throw new t(n,String(r[e]))},r=(e,n)=>{if("Syntax"!==n.kind||n.value!==e)throw new t(e,String(n.value))},i=e=>{for(;"Whitespace"===e.current.kind;)e.next()},a=(e,t=!0)=>{e.next(),t&&i(e)},u=e=>{n("kind","Text",e.current);const t=e.current.value;return a(e),r("=",e.current),a(e),"Data"===e.current.kind?{kind:"Attribute",type:"Data",key:t,value:e.current.value}:(r('"',e.current),a(e),((e,t)=>{const n=[];let i="";for(;'"'!==t.current.value;)"Data"===t.current.kind?(i.length>0&&(n.push({kind:"Composite",type:"Text",value:i}),i=""),n.push({kind:"Composite",type:"Data",value:t.current.value})):i+=t.current.value,a(t);return r('"',t.current),n.length>0?(n.push({kind:"Composite",type:"Text",value:i}),{kind:"Attribute",type:"Composite",key:e,value:n}):{kind:"Attribute",type:"Text",key:e,value:i}})(t,e))},l=e=>"Data"===e.current.kind?{kind:"Child",type:"Data",value:e.current.value}:"Text"===e.current.kind?{kind:"Child",type:"Text",value:e.current.value}:(e=>{r("<",e.current),a(e),n("kind","Text",e.current);const t=e.current.value;a(e);const i=[];for(;"Text"===e.current.kind;)i.push(u(e)),a(e);if("/>"===e.current.value)return r("/>",e.current),a(e),{kind:"Child",type:"Node",tag:t,attributes:i,children:[]};r(">",e.current),a(e);const d=[];for(;"</"!==e.current.value;)d.push(l(e)),a(e);return r("</",e.current),a(e),n("value",t,e.current),a(e),r(">",e.current),{kind:"Child",type:"Node",tag:t,attributes:i,children:d}})(e),d=t=>{const n=(t=>{let n={};const r=()=>("next"in n||(n.next=t.next()),n.next),i={next:()=>{n.previous=n.next,delete n.next,r()},get done(){return Boolean(r().done)},get current(){var t,a,u,l;if(i.done)throw"previous"in n&&"next"in n?new e(`${null===(a=null===(t=n.previous)||void 0===t?void 0:t.value)||void 0===a?void 0:a.value}`):"next"in n?new e(`${null===(l=null===(u=n.next)||void 0===u?void 0:u.value)||void 0===l?void 0:l.value}`):new e;return r().value}};return i})(t);return i(n),l(n)};function*c(e){let t,n,r;for(;!(t=e.next()).done;){if(r=n,n=t.value,"Syntax"===(null==r?void 0:r.kind)&&"Syntax"===n.kind){if("<"===r.value&&"/"===n.value){yield{kind:"Syntax",value:"</"},n=void 0;continue}if("/"===r.value&&">"===n.value){yield{kind:"Syntax",value:"/>"},n=void 0;continue}}r&&(yield r)}n&&(yield n)}function*o(e){let t="";for(const n of e)"Text"!==n.kind?(t&&(yield{kind:"Text",value:t},t=""),yield n):t+=n.value;t&&(yield{kind:"Text",value:t})}function*v(e){for(const t of e)switch(t){case"<":yield{kind:"Syntax",value:"<"};break;case">":yield{kind:"Syntax",value:">"};break;case"/":yield{kind:"Syntax",value:"/"};break;case"=":yield{kind:"Syntax",value:"="};break;case'"':yield{kind:"Syntax",value:'"'};break;case"\n":yield{kind:"Whitespace",value:"\n"};break;case"\r":yield{kind:"Whitespace",value:"\r"};break;case"\t":yield{kind:"Whitespace",value:"\t"};break;case" ":yield{kind:"Whitespace",value:" "};break;default:yield{kind:"Text",value:t}}}function*s(e){for(const t of e)if("Static"===t.type)yield*c(o(v(t.value)));else{if("Dynamic"!==t.type)throw new Error(`Unknown segment: ${t}`);yield{kind:"Data",value:t.value}}}const y=e=>new Array(e.static.length+e.dynamic.length).fill(0).map(((t,n)=>n%2==0?{type:"Static",value:e.static[Math.floor(n/2)]}:{type:"Dynamic",value:e.dynamic[Math.floor(n/2)]})).filter((e=>Boolean(e.value)));function k(e){return d(s("string"==typeof e?y({dynamic:[],static:[e]}):e))}const x=(e,...t)=>d(s(y({dynamic:t,static:[...e]})));export{k as parseXml,x as xml};
