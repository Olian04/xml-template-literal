class e extends SyntaxError{constructor(e){super("UnexpectedEOF"+(e?` near: ${e}`:""))}}class t extends SyntaxError{constructor(e,t){super(`UnexpectedToken: Expected "${e}" but got "${t}"`)}}const n=(e,n,r)=>{if(r[e]!==n)throw new t(n,String(r[e]))},r=(e,n)=>{if("Syntax"!==n.kind||n.value!==e)throw new t(e,String(n.value))},a=e=>{for(;"Whitespace"===e.current.kind;)e.next()},i=(e,t=!0)=>{e.next(),t&&a(e)},u=e=>{n("kind","Text",e.current);const t=e.current.value;return i(e),r("=",e.current),i(e),"Data"===e.current.kind?{kind:"Attribute",type:"Data",key:t,value:e.current.value}:(r('"',e.current),i(e),((e,t)=>{const n=[];let a="";for(;'"'!==t.current.value;)"Data"===t.current.kind?(a.length>0&&(n.push({kind:"Composite",type:"Text",value:a}),a=""),n.push({kind:"Composite",type:"Data",value:t.current.value})):a+=t.current.value,i(t,!1);return r('"',t.current),n.length>0?(n.push({kind:"Composite",type:"Text",value:a}),{kind:"Attribute",type:"Composite",key:e,value:n}):{kind:"Attribute",type:"Text",key:e,value:a}})(t,e))},l=e=>"Data"===e.current.kind?{kind:"Child",type:"Data",value:e.current.value}:"Text"===e.current.kind?{kind:"Child",type:"Text",value:e.current.value}:(e=>{r("<",e.current),i(e),n("kind","Text",e.current);const t=e.current.value;i(e);const a=[];for(;"Text"===e.current.kind;)a.push(u(e)),i(e);if("/>"===e.current.value)return r("/>",e.current),{kind:"Child",type:"Node",tag:t,attributes:a,children:[]};r(">",e.current),i(e);const d=[];for(;"</"!==e.current.value;)d.push(l(e)),i(e);return r("</",e.current),i(e),n("value",t,e.current),i(e),r(">",e.current),{kind:"Child",type:"Node",tag:t,attributes:a,children:d}})(e),d=t=>{const n=(t=>{let n={};const r=()=>("next"in n||(n.next=t.next()),n.next),a={next:()=>{n.previous=n.next,delete n.next,r()},get done(){return Boolean(r().done)},get current(){var t,i,u,l;if(a.done)throw"previous"in n&&"next"in n?new e(`${null===(i=null===(t=n.previous)||void 0===t?void 0:t.value)||void 0===i?void 0:i.value}`):"next"in n?new e(`${null===(l=null===(u=n.next)||void 0===u?void 0:u.value)||void 0===l?void 0:l.value}`):new e;return r().value}};return a})(t);return a(n),l(n)};function*c(e){let t,n,r;for(;!(t=e.next()).done;){if(r=n,n=t.value,"Syntax"===(null==r?void 0:r.kind)&&"Syntax"===n.kind){if("<"===r.value&&"/"===n.value){yield{kind:"Syntax",value:"</"},n=void 0;continue}if("/"===r.value&&">"===n.value){yield{kind:"Syntax",value:"/>"},n=void 0;continue}}r&&(yield r)}n&&(yield n)}function*o(e){let t="";for(const n of e)"Text"!==n.kind?(t&&(yield{kind:"Text",value:t},t=""),yield n):t+=n.value;t&&(yield{kind:"Text",value:t})}function*v(e){for(const t of e)switch(t){case"<":yield{kind:"Syntax",value:"<"};break;case">":yield{kind:"Syntax",value:">"};break;case"/":yield{kind:"Syntax",value:"/"};break;case"=":yield{kind:"Syntax",value:"="};break;case'"':yield{kind:"Syntax",value:'"'};break;case"\n":yield{kind:"Whitespace",value:"\n"};break;case"\r":yield{kind:"Whitespace",value:"\r"};break;case"\t":yield{kind:"Whitespace",value:"\t"};break;case" ":yield{kind:"Whitespace",value:" "};break;default:yield{kind:"Text",value:t}}}function*s(e){for(const t of e)if("Static"===t.type)yield*c(o(v(t.value)));else{if("Dynamic"!==t.type)throw new Error(`Unknown segment: ${t}`);yield{kind:"Data",value:t.value}}}const y=e=>{const t=e.static.length,n=e.dynamic.length;if(t-n!=1)throw new RangeError('Invalid segment lengths: Expected "static.length - dynamic.length" to equal 1 but got '+(t-n));return new Array(t+n).fill(0).map(((t,n)=>n%2==0?{type:"Static",value:e.static[Math.floor(n/2)]}:{type:"Dynamic",value:e.dynamic[Math.floor(n/2)]})).filter((e=>Boolean(e.value)))},k=e=>d(s(y({dynamic:[],static:[e]}))),x=(e,...t)=>d(s(y({dynamic:t,static:[...e]})));export{k as parseXml,x as xml};
